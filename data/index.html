<!DOCTYPE html>
<!-- 
  Rui Santos
  Complete project details at https://RandomNerdTutorials.com  
-->
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP8266 Web Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
 
</head>
<body>
  <h2>ESP8266 Web Server</h2> 
  <form id="f1" action="" method="get">
    <input type="text" name="czas" size="10" />
  </form>
  <br>
  <div > Manualnie </div>
  <br>
  <button onclick=on()> Włącz</button> 
  <button onclick=off()> Wyłącz</button>
  <br><br><br>
  <div> Programowo</div>
  <br>
  <div class="group">
    <input type="text" id="calendar">
  </div>
  <br>

  <button onClick= setStart()> Ustaw Start</button>
  <button onClick= setStop()> Ustaw Stop</button>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>     
      var year, month, day ,hour, minute, seconds
      function on() {
        fetch ("http://192.168.100.7/led2on")
      }
      function off() {
        fetch ("http://192.168.100.7/led2off")
      }
      function setStart() {
        var startValue = document.getElementById("calendar").value;
        console.log("Start value = " + startValue );
        const url = new URL('http://192.168.100.7/');
        url.searchParams.set('start', startValue);
        fetch(url);
      }
      
      function setStop() {
        var stopValue = document.getElementById("calendar").value;
        console.log("Stop value = " + stopValue );

        const url = new URL('http://192.168.100.7/');
        url.searchParams.set('stop', stopValue);
        fetch(url);
      }
      function zegar() {
        var data = new Date();
        year = data.getFullYear();
        month = data.getMonth()+1;
        day = data.getDate();
        hour = data.getHours();
        minute = data.getMinutes();
        second = data.getSeconds();
        var terazjest = ""+ year + ((month<10)?"/0":"/")+ month + ((day<10)?"/0":"/")+ day + "  " +
         +hour+
        ((minute<10)?":0":":")+minute+
        ((second<10)?":0":":")+second;
        document.getElementById("f1").czas.value = terazjest;
        setTimeout("zegar()", 1000);
      }
      zegar();

      flatpickr("#calendar", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
      }); // flatpickr

      // fetch EEprom data
      // (async () => {
          // const res = await fetch("http://192.168.100.7/eeprom");
          //var aa = res.json();
          //console.log(aa);
          // console.log(res.data);
          // console.log(JSON.stringify(res))
          //console.log(((res.json())));
          // const data = res.data
          //  console.log(res.text());
          // console.log(await currentloginid());
          // for (const key in res.text()) {
          //     console.log(`${key}: ${res.text().[key]}`);

          // }
      // })();
      
      // function currentloginid() {
      //   return fetch('http://192.168.100.7/eeprom', {
      //       method: 'GET',
      //     })
      //     .then(function(response) {
      //       return response.json();
      //     })
      //     .then(function(data) {
      //       var userid = JSON.parse(data);
      //       console.log(userid);
      //       return userid;
      //     })
      // }
      // var aa =  currentloginid()
      // console.log(aa);

      function currentloginid() {
        return fetch('http://192.168.100.7/eeprom')
          .then(response => response.json())
      }
      const storedPromise = currentloginid();
      storedPromise.then(storedPromise => {
        //  console.log(JSON.parse(storedPromise))
          for (const key in storedPromise) {
            console.log(`${key}: ${storedPromise[key]}`);
            var aa =storedPromise[key]
            for (const key2 in aa) {
            console.log(`${key2}: ${aa[key2]}`);
            }
          }
      }
      )

    </script>
</body>
</html>
