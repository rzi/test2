<!DOCTYPE html>
<!-- 
  Rui Santos
  Complete project details at https://RandomNerdTutorials.com  
-->
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP8266 Web Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
 
</head>
<body>
  <h2>ESP8266 Web Server</h2> 
  <form id="f1" action="" method="get">
    <input type="text" name="czas" size="10" />
  </form>
  <br>
  <div > Manualnie </div>
  <br>
  <button onclick=on()> Włącz</button> 
  <button onclick=off()> Wyłącz</button>
  <br><br><br>
  <div> Programowo</div>
  <br>
  <div class="group">
    <input type="text" id="calendar">
  </div>
  <br>

  <button onClick= setStart()> Ustaw Start</button>
  <button onClick= setStop()> Ustaw Stop</button>
  <p> Lista zaprogramowana</p>
  <div id="list-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>     
      var year, month, day ,hour, minute, seconds
      function on() {
        fetch ("http://192.168.100.7/led2on")
      }
      function off() {
        fetch ("http://192.168.100.7/led2off")
      }
      function setStart() {
        var startValue = document.getElementById("calendar").value;
        console.log("Start value = " + startValue );
        const url = new URL('http://192.168.100.7/');
        url.searchParams.set('start', startValue);
        fetch(url);
      }
      
      function setStop() {
        var stopValue = document.getElementById("calendar").value;
        console.log("Stop value = " + stopValue );

        const url = new URL('http://192.168.100.7/');
        url.searchParams.set('stop', stopValue);
        fetch(url);
      }
      function zegar() {
        var data = new Date();
        year = data.getFullYear();
        month = data.getMonth()+1;
        day = data.getDate();
        hour = data.getHours();
        minute = data.getMinutes();
        second = data.getSeconds();
        var terazjest = ""+ year + ((month<10)?"/0":"/")+ month + ((day<10)?"/0":"/")+ day + "  " +
         +hour+
        ((minute<10)?":0":":")+minute+
        ((second<10)?":0":":")+second;
        document.getElementById("f1").czas.value = terazjest;
        setTimeout("zegar()", 1000);
      }
      zegar();

      flatpickr("#calendar", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
      }); // flatpickr
      // var list = new List;
      var items1  = new Array();
      var item ="";
      // console.log("Lista " +list.view());

      function currentloginid() {
        return fetch('http://192.168.100.7/eeprom')
          .then(response => response.json())
      }
        const storedPromise = currentloginid();
        storedPromise.then(storedPromise => {
          for (const key in storedPromise) {
            item="";
            //console.log(`${key}`);
            // item =item + key.toString() + " " ;
            let object = storedPromise[key];
            //console.log("object jest typu: " + typeof(object));
            for (const key2 in object) {
              // console.log( `${key2} ${object[key2]}`);
              // console.log("Key2 jest typu " + typeof(key2)+ " to "+ key2);
              // console.log("object[key2] jest typu " + typeof(object[key2]) +" to "+ object[key2]);
              if (key2 == "type" && object[key2]==1){
                item = "start ";
              }else if(key2 == "type" && object[key2]==0){
                item = "stop ";
              } else if(key2 == "type" && object[key2]==-1){
                return
              }
              if (key2 == "year"){
                item = item + object[key2]
              }
              if (key2 =="month") {
                item = item + "/"+object[key2];
              }
              if (key2 =="day") {
                item = item + "/"+object[key2]+" godzina ";
              }
              if (key2 =="hour") {
                item = item +object[key2] +":";
              }
              if (key2 =="minute") {
                if (object[key2]<10){
                  item = item +"0"+ object[key2];
                }else{
                item = item + object[key2] ;
                }
              }
              // console.log(item);
              //item =item + key2.toString() + " " + object[key2] +" ";
            }
            // console.log(item);
            items1.push(item);
            console.log("item3 = " + items1);

            // Znajdź kontener, do którego dodasz listę
            const listContainer = document.getElementById('list-container');
            // Tworzenie elementu <ol> (numerowana lista)
            const ul = document.createElement('ul');
            // Iterowanie po elementach listy
            // items1.forEach((list) => {
                const li = document.createElement('li'); // Tworzenie <li> dla każdego elementu
                li.textContent = item; // Ustawienie tekstu w elemencie <li>
                ul.appendChild(li); // Dodawanie <li> do <ol>
            // });
            // Dodanie <ol> do kontenera
            listContainer.appendChild(ul);
            // console.log("item1 = " + items1);
          }
          // list.append(item);
          // console.log("item2 = "+ item);
          // console.log(list.view());

        }
      )
      // function List() {
      //   this.listElements = [];
      //   this.listSize = 0;
      //   this.pos = 0;
      //   this.append = function(element){
      //     this.listElements[this.listSize++] = element;
      //   };
      //   this.find = function(element){
      //     for (var i = 0; i < this.listElements.length; i++) {
      //       if(this.listElements[i] == element){
      //         return i;
      //       } 
      //     } return -1;
      //   };
      //   this.remove = function(element){
      //     var elemPos = this.find(element)
      //     if(elemPos > -1){
      //       this.listElements.splice(elemPos,1);
      //       this.listSize--;
      //     }
      //   };
      //   this.length = function(){
      //     return this.listSize;
      //   };
      //   this.view = function(){
      //     return this.listElements;
      //   };
      //   this.insert = function(element, after){
      //     var afterPos = this.find(after);
      //     if(afterPos > -1){
      //       this.listElements.splice(afterPos+1,0,element);
      //       this.listSize++;
      //     }
      //   };
      //   this.contains = function(element){
      //     var elemPos = this.find(element);
      //     if(elemPos > -1) {
      //       return true;
      //     } else {
      //       return false;
      //     }
      //   };
      //   this.moveTo = function(position){
      //     this.pos = position
      //   };
      //   this.getElem = function(){
      //     return this.listElements[this.pos];
      //   };
      //   this.previous = function(){
      //     return this.listElements[--this.pos];
      //   };
      //   this.next = function(){
      //     return this.listElements[this.pos++];
      //   };
      //   this.front = function(){
      //     this.pos = 0;
      //   }
      //   this.end = function(){
      //     this.pos = this.listSize-1;
      //   }
      // }

    </script>
</body>
</html>
